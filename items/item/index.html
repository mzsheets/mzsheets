<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="MZsheets - Your go-to source for cnfans links. Find everything you need in one place.">
    <meta name="keywords" content="cnfans, mzsheets, links, cnfans links, cnfans items, cnfans database, reps, clothes, fashion, designer, shoes, trainers, kicks, pandabuy, kakobuy, taobao, aliexpress, shein, dhgate, alibaba, cnfans shoes, cnfans clothes, cnfans fashion, cnfans designer, cnfans trainers, cnfans kicks">
    <meta name="author" content="Max Tasker">
    <link rel="stylesheet" href="../../data/components/globalstyle.css">
    <link rel="stylesheet" href="style.css">
    <link rel="shortcut icon" href="../../data/assets/mzsheets/logo-600-black-white.png" type="image/x-icon">
    <title>Item | MZsheets</title>
</head>
<body>
    <div id="top"></div>
    <header>
        <div id="main-navbar"></div>
    </header>
    <main class="page-content">
        <div class="item-container">
            <img alt="Item image" class="item-thumbnail">
            <div class="item-info">
                <h1 class="item-name"></h1>
                <p class="item-price"></p>
                <div class="item-controls">
                    <a href="https://mzsheets.com/error/Index.html?error-code=404" class="item-link"><img src="../../data/assets/cnfans.png" alt="Cnfans" class="item-link-icon"></a>
                    <a href="https://mzsheets.com/wishlist/" onclick="addToWishlist()" class="wishlist-button"><img src="../../data/assets/star-filled.png" alt="" class="item-link-icon"></a>
                </div>
            </div>
        </div>
    </main>
    <footer>
        <div id="main-footer"></div>
    </footer>
    <script>
        // Get query parameters
        const urlParams = new URLSearchParams(window.location.search);
        const id = urlParams.get('id') ? parseInt(urlParams.get('id')) : null;

        let item = null;

        // Load the navbar
        fetch('../../data/components/navbar.html')
            .then(response => response.text())
            .then(data => {
                document.getElementById('main-navbar').innerHTML = data;
            })
            .catch(error => console.error('Error loading navbar:', error)
        );

        // Load the footer
        fetch('../../data/components/footer.html')
            .then(response => response.text())
            .then(data => {
                document.getElementById('main-footer').innerHTML = data;
            })
            .catch(error => console.error('Error loading footer:', error)
        );

        // Get item by ID
        fetch('https://mzsheets.com/data/products-data.json')
            .then(response => response.json())
            .then(data => {
                if (!id) {
                    window.location.href = 'https://mzsheets.com/error/?error-code=400';
                }
                item = data.find(item => item.id === id);
                if (!item) {
                    window.location.href = 'https://mzsheets.com/error/?error-code=404';
                }

                // Update title to reflect item
                document.title = `${item.name} | MZsheets`;

                // Update meta tags
                updateMetaTags(item);
                
                // Load the items information
                document.querySelector('.item-thumbnail').src = item.image;
                document.querySelector('.item-name').innerText = item.name;
                document.querySelector('.item-link').href = item.link;
                document.querySelector('.item-link').setAttribute('target', '_blank');
                document.querySelector('.item-link').setAttribute('rel', 'noopener noreferrer');

                // Get currency if available
                const currency = getCookie('currency') || 'usd';
                document.querySelector('.item-price').innerText = getPriceString(convertCurrency(item.price, item.currency, currency), currency);
            })
            .catch(error => console.error('Error loading item:', error)
        );

        // Function to update meta tags dynamically
        function updateMetaTags(item) {
            const head = document.head;

            // Helper function to create or update a meta tag
            function setMetaTag(property, content, isProperty = true) {
                let metaTag = document.querySelector(
                    isProperty ? `meta[property="${property}"]` : `meta[name="${property}"]`
                );
                if (!metaTag) {
                    metaTag = document.createElement('meta');
                    if (isProperty) {
                        metaTag.setAttribute('property', property);
                    } else {
                        metaTag.setAttribute('name', property);
                    }
                    head.appendChild(metaTag);
                }
                metaTag.setAttribute('content', content);
            }

            // Open Graph Meta Tags
            setMetaTag('og:title', `${item.name} | MZsheets`);
            setMetaTag('og:description', `Check out ${item.name} on MZsheets. Price: ${item.price} ${item.currency.toUpperCase()}.`);
            setMetaTag('og:url', `https://mzsheets.com/items/item/?id=${item.id}`);
            setMetaTag('og:image', item.image);
            setMetaTag('og:type', 'product');

            // Twitter Meta Tags
            setMetaTag('twitter:card', 'summary_large_image', false);
            setMetaTag('twitter:title', `${item.name} | MZsheets`, false);
            setMetaTag('twitter:description', `Check out ${item.name} on MZsheets.`, false);
            setMetaTag('twitter:image', item.image, false);
        }

        // Function to convert currencies
        function convertCurrency(amount, fromCurrency, toCurrency) {
            // Conversion rates
            const conversionRates = {
                gbp: 0.77,
                usd: 1,
                eur: 0.93
            };

            // Convert the amount
            return amount * conversionRates[toCurrency] / conversionRates[fromCurrency];
        }

        // Function to get prices in the selected currency as a string
        function getPriceString(amount, currency) {
            const currencySymbols = {
                gbp: '£',
                usd: '$',
                eur: '€'
            };

            return `${currencySymbols[currency]}${String(amount.toFixed(2))}`;
        }

        // Set a cookie
        function setCookie(cname, cvalue, exdays) {
            var d = new Date();
            d.setTime(d.getTime() + (exdays*24*60*60*1000));
            var expires = "expires="+ d.toUTCString();
            document.cookie = cname + "=" + cvalue + ";" + expires + ";path=/";
        }

        // Get a cookie
        function getCookie(cname) {
            var name = cname + "=";
            var decodedCookie = decodeURIComponent(document.cookie);
            var ca = decodedCookie.split(';');
            for(var i = 0; i <ca.length; i++) {
                var c = ca[i];
                while (c.charAt(0) == ' ') {
                    c = c.substring(1);
                }
                if (c.indexOf(name) == 0) {
                    return c.substring(name.length, c.length);
                }
            }
            return "";
        }

        // Add an item to the wishlist
        function addToWishlist() {
            if (!item) {
                alert('Item not found!');
                return;
            }

            let wishlist = getCookie('wishlist');
            wishlist = wishlist ? JSON.parse(wishlist) : [];

            // Check if the item already exists in the wishlist by its ID
            if (!wishlist.some(wishlistItem => wishlistItem.id === item.id)) {
                wishlist.push(item);
                setCookie('wishlist', JSON.stringify(wishlist), 365); // Store for 265 days
            } else {
                alert('Item is already in the wishlist!');
            }
        }
    </script>
</body>
</html>